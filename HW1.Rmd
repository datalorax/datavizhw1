---
title: "Homework 1"
author: 
  - Makayla Whitney
  - Joe Swinehart
  - Janette Avelar
  - David Fainstein
date: "2/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
library(dplyr)
library(gghighlight)
```

```{r Read in Data}
here::here("data")

assessments <- read_csv(here("data", "assessments.csv"))
courses     <- read_csv(here("data", "courses.csv"))
stu_assess  <- read_csv(here("data", "studentAssessment.csv"))
stu_info    <- read_csv(here("data", "studentInfo.csv"))
stu_reg     <- read_csv(here("data", "studentRegistration.csv"))
stu_vle     <- read_csv(here("data", "studentVle.csv"))
vle         <- read_csv(here("data", "vle.csv"))
```


```{r Mutating Join 1}

MJ1 <- left_join(stu_info, stu_assess) %>% 
  select(id_student,
         final_result,
         highest_education,
         gender,
         score) %>% 
  mutate(score = as.numeric(score)) %>% 
  group_by(highest_education, gender, final_result) %>% 
  summarise(score = mean(score, na.rm = TRUE)) %>% 
  mutate(highest_education = as.factor(highest_education)) %>% 
  mutate(highest_education = fct_relevel(highest_education,
             "No Formal quals",
             "Lower Than A Level",
             "A Level or Equivalent",
             "HE Qualification",
             "Post Graduate Qualification"))

```

```{r Data Display 1}

ggplot(MJ1, aes(score, highest_education, color = gender)) +
    geom_point() +
  facet_wrap(~final_result) +
  labs(x = "Average Score",
       y = "Highest Education ") +
  scale_color_manual(values = c("#66B2FF", "#0066CC"))

```

```{r Mutating Join 2}
MJ2 <- left_join(stu_vle, vle) %>% 
  select(code_module,
         code_presentation,
         id_student,
         sum_click,
         activity_type) %>% 
  mutate(activity_type = factor(activity_type,
                                levels = c("oucontent",
                                           "forumng",
                                           "quiz",
                                           "homepage",
                                           "subpage",
                                           "resource",
                                           "ouwiki",
                                           "url",
                                           "oucollaborate",
                                           "glossary",
                                           "questionnaire",
                                           "externalquiz",
                                           "page",
                                           "dataplus",
                                           "ouelluminate",
                                           "dualpane",
                                           "htmlactivity",
                                           "folder",
                                           "sharedsubpage",
                                           "repeatactivity"))) %>% 
  group_by(id_student, activity_type, code_presentation, code_module) %>% 
  summarize(sum_click = sum(sum_click))
```

```{r Data Display 2}
ggplot(subset(MJ2, activity_type %in% c("oucontent",
                                        "forumng",
                                        "quiz",
                                        "homepage",
                                        "subpage",
                                        "resource",
                                        "ouwiki",
                                        "url",
                                        "oucollaborate",
                                        "glossary")),
              aes(activity_type, sum_click)) +
  geom_jitter(color = "gray70",
                  alpha = .4, 
                  width = .2,
                  height = .5,
                  show.legend = FALSE) +
  gghighlight(calculate_per_facet = TRUE) +
  facet_grid(cols = vars(code_module)) +
  coord_flip() +
  theme_minimal()
```

```{r Mutating Join 3}

```

```{r Data Display 3}

```

```{r Filtering Join}

stu_assess_avg <- stu_assess %>%
  mutate(score = as.numeric(score)) %>% 
  group_by(id_student) %>%
  summarize(score_avg = mean(score) + 3*sd(score),
            score_avg = unique(score_avg))

cut_mean <- stu_assess_avg %>%
  ungroup() %>%
  filter(stu_assess_avg > score_avg)

semi_join(stu_assess, cut_mean)
  
```

```{r Reproduced Figure}

ggplot(MJ1, aes(score, highest_education, color = gender)) +
  geom_line(color = "#636363", size = 2) +
  geom_point(size = 3) +
  facet_wrap(~final_result) +
  labs(x = "Average Score",
       y = "Highest Education ") +
  scale_color_manual(values = c("#66B2FF", "#0066CC")) +
  theme_minimal()

```

```{r Extra Credit (Optional)}

higher_mean <- MJ1 %>%
  mutate(higher_mean = mean(score)) %>%
  summarize(higher_mean = unique(higher_mean))

ggplot(MJ1, aes(score, highest_education, color = gender)) +
  geom_line(color = higher_mean, size = 2) +
  geom_point(size = 3) +
  facet_wrap(~final_result) +
  labs(x = "Average Score",
       y = "Highest Education ") +
  scale_color_manual(values = c("#66B2FF", "#0066CC")) +
  theme_minimal()

```
